(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{409:function(s,a,t){"use strict";t.r(a);var e=t(56),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"原理简述"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#原理简述"}},[s._v("#")]),s._v(" 原理简述")]),s._v(" "),t("p",[s._v("先抛结论： "),t("strong",[s._v("脚手架的本质是一个操作系统的客户端")]),s._v("，只是它没有图形界面。")]),s._v(" "),t("p",[s._v("这里以 windows 操作系统下全局安装的 "),t("code",[s._v("vue")]),s._v("命令为例来讲解脚手架的原理：")]),s._v(" "),t("h3",{attrs:{id:"_1-下载包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载包"}},[s._v("#")]),s._v(" 1. 下载包")]),s._v(" "),t("p",[t("code",[s._v("npm install vue -g")]),s._v("的时候，npm 会把 vue 包下载到在"),t("code",[s._v("C:\\Users\\xxx\\AppData\\Roaming\\npm\\node_modules")]),s._v("目录下")]),s._v(" "),t("img",{attrs:{src:s.$withBase("/imgs/cli/principle-path.png")}}),s._v(" "),t("h3",{attrs:{id:"_2-根据-package-json-中的配置生成软链接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-根据-package-json-中的配置生成软链接"}},[s._v("#")]),s._v(" 2. 根据 package.json 中的配置生成软链接")]),s._v(" "),t("p",[s._v("解析包的时候，如果发现 package.json 中存在 bin 配置，则生成软链接，（注：可以在 bash 上执行"),t("code",[s._v("where vue")]),s._v("查看软链接所在路径）")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// C:\\Users\\cjh\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli\\package.json")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"@vue/cli"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"bin"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"vue"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bin/vue.js"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n")])])]),t("img",{staticStyle:{transform:"scale(0.9)"},attrs:{src:s.$withBase("/imgs/cli/soft-connection.png")}}),s._v(" "),t("h3",{attrs:{id:"_3-软链接中指定目标执行文件的位置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-软链接中指定目标执行文件的位置"}},[s._v("#")]),s._v(" 3. 软链接中指定目标执行文件的位置")]),s._v(" "),t("p",[s._v("我们用编辑器打开这个软件接（路径 C:\\Users\\cjh\\AppData\\Roaming\\npm\\vue）, 可以看到如下内容，其中 if else 里指定了不同情况下目标执行文件的位置。")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("basedir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dirname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$0")]),s._v('"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s,\\\\,/,g'")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("case")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("\n    *CYGWIN*"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("basedir")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("cygpath -w "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v('"')]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("esac")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -x "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v('/node"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v('/node"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v('/node_modules/@vue/cli/bin/vue.js"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ret")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basedir")]),s._v('/node_modules/@vue/cli/bin/vue.js"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$@")]),s._v('"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ret")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$?")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ret")]),s._v("\n\n")])])]),t("h3",{attrs:{id:"_4-通过-usr-bin-env-node-指定运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-通过-usr-bin-env-node-指定运行环境"}},[s._v("#")]),s._v(" 4. 通过 #!/usr/bin/env node 指定运行环境")]),s._v(" "),t("p",[s._v("打开目标执行文件 vue.js 文件，可以看到第一行写着 "),t("code",[s._v("#!/usr/bin/env node")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// C:\\Users\\cjh\\AppData\\Roaming\\npm\\node_modules\\@vue\\cli\\bin\\vue.js")]),s._v("\n#"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bin"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("env node\n")])])]),t("p",[s._v("这行代码有什么用呢？")]),s._v(" "),t("p",[t("strong",[s._v("我们在 bash 中执行"),t("code",[s._v("/usr/bin/env")]),s._v("，可以看到打印出了所有的环境变量。 而"),t("code",[s._v("#!/usr/bin/env node")]),s._v("的作用就是指定 vue.js 的运行环境为 node！")])]),s._v(" "),t("p",[s._v("这里我们可以做一个小测试，在桌面上新建一个 test.js 文件，并在 bash 中输入"),t("code",[s._v("./test.js")]),s._v("，发现报错了。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'console.log(123)'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" test.js\n./test.js  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 报错")]),s._v("\n")])])]),t("p",[s._v("但是如果我们在在首行加一行 "),t("code",[s._v("#!/usr/bin/env node")]),s._v("，再执行"),t("code",[s._v("./test.js")]),s._v("，发现打印了 123！")]),s._v(" "),t("p",[s._v("注：这里执行"),t("code",[s._v("./test.js")]),s._v("等价于"),t("code",[s._v("node ./test.js")]),s._v("，同时等价于 "),t("code",[s._v("/usr/bin/env node ./test.js")]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_5-总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-总结"}},[s._v("#")]),s._v(" 5. 总结")]),s._v(" "),t("p",[s._v("当我们执行 vue 相关命令的时候，操作系统会通过"),t("code",[s._v("where vue")]),s._v("找到 vue 软连接的路径，然后通过软链接找到目标文件(即 vue.js)的路径，再在指定环境（node）执行这个文件。")])])}),[],!1,null,null,null);a.default=n.exports}}]);